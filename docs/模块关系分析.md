# src/screenshot2chat ä¸ src/screenshotanalysis æ¨¡å—å…³ç³»åˆ†æ

## ğŸ“Š åˆ†ææ¦‚è¿°

**åˆ†ææ—¥æœŸ**: 2026-02-13  
**åˆ†æç›®çš„**: ç¡®å®šä¸¤ä¸ªæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»å’Œæ¶æ„è®¾è®¡

---

## ğŸ”— å…³ç³»æ€»ç»“

### æ ¸å¿ƒå…³ç³»
- **screenshot2chat** â†’ **screenshotanalysis** (å•å‘ä¾èµ–)
- **screenshotanalysis** â† **screenshot2chat** (æ— åå‘ä¾èµ–)

### å…³ç³»æ€§è´¨
- **screenshot2chat** æ˜¯æ–°çš„æ¨¡å—åŒ–æ¡†æ¶
- **screenshotanalysis** æ˜¯æ—§çš„å•ä½“å®ç°
- **screenshot2chat** é€šè¿‡å…¼å®¹å±‚åŒ…è£… **screenshotanalysis** çš„åŠŸèƒ½

---

## ğŸ“‹ è¯¦ç»†ä¾èµ–åˆ†æ

### 1. screenshot2chat å¯¹ screenshotanalysis çš„ä¾èµ–

#### ç›´æ¥ä¾èµ–çš„æ–‡ä»¶å’Œç»„ä»¶

| screenshot2chat æ–‡ä»¶ | ä¾èµ–çš„ screenshotanalysis ç»„ä»¶ | ç”¨é€” |
|---------------------|------------------------------|------|
| `detectors/bubble_detector.py` | `chat_layout_detector.ChatLayoutDetector` | æ°”æ³¡æ£€æµ‹æ ¸å¿ƒé€»è¾‘ |
| `detectors/bubble_detector.py` | `basemodel.TextBox` | æ•°æ®æ¨¡å‹è½¬æ¢ |
| `extractors/speaker_extractor.py` | `basemodel.TextBox` | æ•°æ®æ¨¡å‹ |
| `extractors/speaker_extractor.py` | `chat_layout_detector.ChatLayoutDetector` | è¯´è¯è€…è¯†åˆ« |
| `extractors/nickname_extractor.py` | `basemodel.TextBox` | æ•°æ®æ¨¡å‹ |
| `extractors/nickname_extractor.py` | `nickname_extractor.extract_nicknames_from_text_boxes` | æ˜µç§°æå–åŠŸèƒ½ |
| `extractors/layout_extractor.py` | `basemodel.TextBox` | æ•°æ®æ¨¡å‹ |
| `extractors/layout_extractor.py` | `chat_layout_detector.ChatLayoutDetector` | å¸ƒå±€åˆ†æ |

#### ä¾èµ–å…³ç³»å›¾

```
screenshot2chat/
â”œâ”€â”€ detectors/
â”‚   â””â”€â”€ bubble_detector.py
â”‚       â”œâ”€â”€ â†’ screenshotanalysis.chat_layout_detector.ChatLayoutDetector
â”‚       â””â”€â”€ â†’ screenshotanalysis.basemodel.TextBox
â”œâ”€â”€ extractors/
â”‚   â”œâ”€â”€ speaker_extractor.py
â”‚   â”‚   â”œâ”€â”€ â†’ screenshotanalysis.basemodel.TextBox
â”‚   â”‚   â””â”€â”€ â†’ screenshotanalysis.chat_layout_detector.ChatLayoutDetector
â”‚   â”œâ”€â”€ nickname_extractor.py
â”‚   â”‚   â”œâ”€â”€ â†’ screenshotanalysis.basemodel.TextBox
â”‚   â”‚   â””â”€â”€ â†’ screenshotanalysis.nickname_extractor.extract_nicknames_from_text_boxes
â”‚   â””â”€â”€ layout_extractor.py
â”‚       â”œâ”€â”€ â†’ screenshotanalysis.basemodel.TextBox
â”‚       â””â”€â”€ â†’ screenshotanalysis.chat_layout_detector.ChatLayoutDetector
â””â”€â”€ compat/
    â””â”€â”€ chat_layout_detector.py
        â””â”€â”€ â†’ (åŒ…è£…æ•´ä¸ª screenshotanalysis æ¨¡å—)
```

### 2. screenshotanalysis å¯¹ screenshot2chat çš„ä¾èµ–

**ç»“æœ**: âŒ **æ— ä»»ä½•ä¾èµ–**

screenshotanalysis æ¨¡å—å®Œå…¨ç‹¬ç«‹ï¼Œä¸ä¾èµ– screenshot2chat çš„ä»»ä½•ç»„ä»¶ã€‚

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡åˆ†æ

### è®¾è®¡æ¨¡å¼

#### 1. é€‚é…å™¨æ¨¡å¼ (Adapter Pattern)
- **screenshot2chat** ä½¿ç”¨é€‚é…å™¨æ¨¡å¼åŒ…è£… **screenshotanalysis** çš„åŠŸèƒ½
- é€šè¿‡ `compat/chat_layout_detector.py` æä¾›å‘åå…¼å®¹æ€§

#### 2. é—¨é¢æ¨¡å¼ (Facade Pattern)
- **screenshot2chat** ä¸ºå¤æ‚çš„ **screenshotanalysis** åŠŸèƒ½æä¾›ç®€åŒ–æ¥å£
- é€šè¿‡æµæ°´çº¿ç³»ç»Ÿç»Ÿä¸€ç®¡ç†å„ç§æ£€æµ‹å’Œæå–æ“ä½œ

#### 3. ç­–ç•¥æ¨¡å¼ (Strategy Pattern)
- **screenshot2chat** å°†ä¸åŒçš„æ£€æµ‹å’Œæå–ç®—æ³•å°è£…ä¸ºå¯æ’æ‹”çš„ç»„ä»¶
- åº•å±‚å®ç°ä»ä¾èµ– **screenshotanalysis** çš„å…·ä½“ç®—æ³•

### ç‰ˆæœ¬æ¼”è¿›

```
æ—¶é—´çº¿: æ—§ç‰ˆæœ¬ â†’ æ–°ç‰ˆæœ¬

screenshotanalysis (v0.1.0)
â”œâ”€â”€ å•ä½“æ¶æ„
â”œâ”€â”€ ç´§è€¦åˆè®¾è®¡
â”œâ”€â”€ ç›´æ¥å‡½æ•°è°ƒç”¨
â””â”€â”€ åº”ç”¨ç‰¹å®šçš„å®ç°

                â†“ é‡æ„

screenshot2chat (v0.2.0)
â”œâ”€â”€ æ¨¡å—åŒ–æ¶æ„
â”œâ”€â”€ æ¾è€¦åˆè®¾è®¡
â”œâ”€â”€ æµæ°´çº¿ç³»ç»Ÿ
â”œâ”€â”€ åº”ç”¨æ— å…³çš„æŠ½è±¡
â””â”€â”€ å‘åå…¼å®¹å±‚ â†’ screenshotanalysis
```

---

## ğŸ” å…·ä½“ä¾èµ–è¯¦æƒ…

### 1. BubbleDetector çš„ä¾èµ–

```python
# src/screenshot2chat/detectors/bubble_detector.py

# æ ¸å¿ƒä¾èµ–
from screenshotanalysis.chat_layout_detector import ChatLayoutDetector
from screenshotanalysis.basemodel import TextBox

class BubbleDetector(BaseDetector):
    def load_model(self):
        # ç›´æ¥ä½¿ç”¨ screenshotanalysis çš„ ChatLayoutDetector
        self.layout_detector = ChatLayoutDetector(...)
    
    def _convert_to_textboxes(self, boxes):
        # è½¬æ¢ä¸º screenshotanalysis çš„ TextBox æ ¼å¼
        text_box = TextBox(box=box.bbox, score=box.score)
```

**ä¾èµ–æ€§è´¨**: 
- âœ… **å¼ºä¾èµ–** - æ ¸å¿ƒåŠŸèƒ½å®Œå…¨ä¾èµ– screenshotanalysis
- âš ï¸ **æ•°æ®è½¬æ¢** - éœ€è¦åœ¨ä¸¤ç§æ•°æ®æ ¼å¼é—´è½¬æ¢

### 2. æå–å™¨çš„ä¾èµ–

```python
# src/screenshot2chat/extractors/*.py

# å…±åŒä¾èµ–
from screenshotanalysis.basemodel import TextBox
from screenshotanalysis.chat_layout_detector import ChatLayoutDetector

# ç‰¹å®šä¾èµ–
from screenshotanalysis.nickname_extractor import extract_nicknames_from_text_boxes
```

**ä¾èµ–æ€§è´¨**:
- âœ… **åŠŸèƒ½å¤ç”¨** - ç›´æ¥ä½¿ç”¨ screenshotanalysis çš„ç®—æ³•
- âš ï¸ **æ¥å£é€‚é…** - éœ€è¦é€‚é…ä¸åŒçš„æ¥å£é£æ ¼

### 3. å…¼å®¹å±‚çš„ä¾èµ–

```python
# src/screenshot2chat/compat/chat_layout_detector.py

class ChatLayoutDetector:
    """å®Œå…¨å…¼å®¹çš„åŒ…è£…å™¨"""
    
    def __init__(self, ...):
        # å†…éƒ¨ä½¿ç”¨æ–°çš„ BubbleDetectorï¼Œä½† BubbleDetector åˆä¾èµ–æ—§çš„å®ç°
        self._detector = BubbleDetector(config=config)
        self._layout_detector = self._detector.layout_detector  # æ—§å®ç°
```

**ä¾èµ–æ€§è´¨**:
- ğŸ”„ **å¾ªç¯åŒ…è£…** - æ–°åŒ…è£…æ—§ï¼Œæ—§è¢«æ–°åŒ…è£…
- âš ï¸ **è¿‡æ¸¡è®¾è®¡** - ç”¨äºå¹³æ»‘è¿ç§»

---

## ğŸ“Š ä¾èµ–ç»Ÿè®¡

### æ–‡ä»¶çº§ä¾èµ–ç»Ÿè®¡

| screenshot2chat æ¨¡å— | ä¾èµ–çš„ screenshotanalysis æ–‡ä»¶æ•° | ä¾èµ–å¼ºåº¦ |
|---------------------|------------------------------|----------|
| detectors/ | 2 ä¸ªæ–‡ä»¶ | å¼ºä¾èµ– |
| extractors/ | 3 ä¸ªæ–‡ä»¶ | å¼ºä¾èµ– |
| compat/ | å…¨éƒ¨æ–‡ä»¶ | å®Œå…¨ä¾èµ– |
| å…¶ä»–æ¨¡å— | 0 ä¸ªæ–‡ä»¶ | æ— ä¾èµ– |

### ç»„ä»¶çº§ä¾èµ–ç»Ÿè®¡

| screenshotanalysis ç»„ä»¶ | è¢« screenshot2chat ä½¿ç”¨æ¬¡æ•° | é‡è¦æ€§ |
|------------------------|---------------------------|--------|
| `ChatLayoutDetector` | 4 æ¬¡ | æ ¸å¿ƒç»„ä»¶ |
| `TextBox` | 4 æ¬¡ | æ ¸å¿ƒæ•°æ®æ¨¡å‹ |
| `extract_nicknames_from_text_boxes` | 1 æ¬¡ | ä¸“ç”¨åŠŸèƒ½ |

---

## ğŸ¯ å…³ç³»ç‰¹ç‚¹åˆ†æ

### ä¼˜ç‚¹ âœ…

1. **æ¸è¿›å¼è¿ç§»**
   - æ–°æ¡†æ¶å¯ä»¥é€æ­¥æ›¿æ¢æ—§å®ç°
   - ä¿æŒå‘åå…¼å®¹æ€§
   - é™ä½è¿ç§»é£é™©

2. **åŠŸèƒ½å¤ç”¨**
   - é¿å…é‡å¤å®ç°å¤æ‚ç®—æ³•
   - åˆ©ç”¨å·²éªŒè¯çš„åŠŸèƒ½
   - åŠ é€Ÿå¼€å‘è¿›ç¨‹

3. **æ¸…æ™°çš„æ¶æ„åˆ†å±‚**
   - æ–°æ¡†æ¶ä¸“æ³¨äºæ¶æ„å’Œæ¥å£è®¾è®¡
   - æ—§æ¨¡å—ä¸“æ³¨äºç®—æ³•å®ç°
   - èŒè´£åˆ†ç¦»æ˜ç¡®

### ç¼ºç‚¹ âš ï¸

1. **å¼ºè€¦åˆä¾èµ–**
   - screenshot2chat æ— æ³•ç‹¬ç«‹è¿è¡Œ
   - å¿…é¡»åŒæ—¶ç»´æŠ¤ä¸¤ä¸ªæ¨¡å—
   - å¢åŠ äº†ç³»ç»Ÿå¤æ‚æ€§

2. **æ•°æ®è½¬æ¢å¼€é”€**
   - DetectionResult â†” TextBox è½¬æ¢
   - å¯èƒ½å½±å“æ€§èƒ½
   - å¢åŠ äº†å‡ºé”™çš„å¯èƒ½æ€§

3. **ç»´æŠ¤è´Ÿæ‹…**
   - éœ€è¦åŒæ—¶ç»´æŠ¤ä¸¤å¥—ä»£ç 
   - å…¼å®¹æ€§æµ‹è¯•å¤æ‚
   - ç‰ˆæœ¬åŒæ­¥å›°éš¾

### é£é™© ğŸš¨

1. **æŠ€æœ¯å€ºåŠ¡**
   - é•¿æœŸä¾èµ–æ—§ä»£ç 
   - éš¾ä»¥å½»åº•é‡æ„
   - å¯èƒ½å½±å“æ–°åŠŸèƒ½å¼€å‘

2. **ç‰ˆæœ¬å†²çª**
   - ä¸¤ä¸ªæ¨¡å—ç‰ˆæœ¬ä¸åŒ¹é…
   - API å˜æ›´å½±å“å…¼å®¹æ€§
   - ä¾èµ–ç®¡ç†å¤æ‚

---

## ğŸš€ å‘å±•å»ºè®®

### çŸ­æœŸç­–ç•¥ (1-3ä¸ªæœˆ)

1. **ä¿æŒç°çŠ¶**
   - ç»§ç»­ä½¿ç”¨å½“å‰çš„ä¾èµ–å…³ç³»
   - å®Œå–„å…¼å®¹å±‚çš„åŠŸèƒ½
   - ä¿®å¤å·²çŸ¥çš„å…¼å®¹æ€§é—®é¢˜

2. **å¢å¼ºæµ‹è¯•**
   - æ·»åŠ è·¨æ¨¡å—é›†æˆæµ‹è¯•
   - ç¡®ä¿ç‰ˆæœ¬å…¼å®¹æ€§
   - ç›‘æ§æ€§èƒ½å½±å“

### ä¸­æœŸç­–ç•¥ (3-6ä¸ªæœˆ)

1. **é€æ­¥è§£è€¦**
   - å°†æ ¸å¿ƒç®—æ³•ä» screenshotanalysis è¿ç§»åˆ° screenshot2chat
   - å‡å°‘å¯¹ screenshotanalysis çš„ä¾èµ–
   - ä¿æŒæ¥å£å…¼å®¹æ€§

2. **æ€§èƒ½ä¼˜åŒ–**
   - å‡å°‘æ•°æ®è½¬æ¢å¼€é”€
   - ä¼˜åŒ–å†…å­˜ä½¿ç”¨
   - æå‡å¤„ç†é€Ÿåº¦

### é•¿æœŸç­–ç•¥ (6ä¸ªæœˆä»¥ä¸Š)

1. **å®Œå…¨ç‹¬ç«‹**
   - screenshot2chat å®ç°æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
   - screenshotanalysis æ ‡è®°ä¸º legacy
   - æä¾›è¿ç§»å·¥å…·å’Œæ–‡æ¡£

2. **æ¶æ„å‡çº§**
   - åŸºäºç»éªŒé‡æ–°è®¾è®¡æ ¸å¿ƒç®—æ³•
   - é‡‡ç”¨æ›´ç°ä»£çš„æŠ€æœ¯æ ˆ
   - æä¾›æ›´å¥½çš„æ‰©å±•æ€§

---

## ğŸ“ è¿ç§»è·¯å¾„

### é˜¶æ®µ 1: å½“å‰çŠ¶æ€
```
screenshot2chat (æ–°æ¥å£) â†’ screenshotanalysis (æ—§å®ç°)
```

### é˜¶æ®µ 2: éƒ¨åˆ†è¿ç§»
```
screenshot2chat (æ–°æ¥å£ + éƒ¨åˆ†æ–°å®ç°) â†’ screenshotanalysis (éƒ¨åˆ†æ—§å®ç°)
```

### é˜¶æ®µ 3: å®Œå…¨ç‹¬ç«‹
```
screenshot2chat (æ–°æ¥å£ + å®Œæ•´æ–°å®ç°)
screenshotanalysis (legacy, ä»…å…¼å®¹æ€§)
```

### é˜¶æ®µ 4: æœ€ç»ˆçŠ¶æ€
```
screenshot2chat (ç‹¬ç«‹å®Œæ•´æ¡†æ¶)
```

---

## ğŸ”š ç»“è®º

### å…³ç³»æ€§è´¨
- **screenshot2chat** å’Œ **screenshotanalysis** å­˜åœ¨ **å•å‘å¼ºä¾èµ–** å…³ç³»
- **screenshot2chat** æ˜¯æ–°çš„æ¨¡å—åŒ–æ¡†æ¶ï¼Œ**screenshotanalysis** æ˜¯æ—§çš„å®ç°
- é€šè¿‡é€‚é…å™¨æ¨¡å¼å®ç°å‘åå…¼å®¹å’ŒåŠŸèƒ½å¤ç”¨

### è®¾è®¡åˆç†æ€§
- âœ… **åˆç†çš„è¿‡æ¸¡è®¾è®¡** - å…è®¸æ¸è¿›å¼è¿ç§»
- âœ… **åŠŸèƒ½å¤ç”¨** - é¿å…é‡å¤å¼€å‘
- âš ï¸ **æŠ€æœ¯å€ºåŠ¡** - é•¿æœŸç»´æŠ¤ä¸¤å¥—ä»£ç 

### æœªæ¥æ–¹å‘
- å»ºè®®é‡‡ç”¨æ¸è¿›å¼è§£è€¦ç­–ç•¥
- æœ€ç»ˆç›®æ ‡æ˜¯ screenshot2chat å®Œå…¨ç‹¬ç«‹
- éœ€è¦åˆ¶å®šè¯¦ç»†çš„è¿ç§»è®¡åˆ’å’Œæ—¶é—´è¡¨

è¿™ç§è®¾è®¡ä½“ç°äº†è½¯ä»¶å·¥ç¨‹ä¸­å¸¸è§çš„"æ–°æ—§ç³»ç»Ÿå¹¶å­˜"çš„è¿‡æ¸¡æ¨¡å¼ï¼Œæ˜¯ä¸€ä¸ªåŠ¡å®çš„æ¶æ„é€‰æ‹©ã€‚