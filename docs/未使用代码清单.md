# screenshotanalysis æœªä½¿ç”¨ä»£ç æ¸…å•

**åˆ†æåŸºå‡†**: `src/screenshotanalysis/dialog_pipeline2.py`  
**åˆ†ææ—¥æœŸ**: 2026-02-13

---

## ğŸ“‹ å¿«é€Ÿæ€»ç»“

- âœ… **å¯å®‰å…¨åˆ é™¤**: 3 ä¸ªæ–‡ä»¶
- âš ï¸ **éƒ¨åˆ†æœªä½¿ç”¨**: 4 ä¸ªæ–‡ä»¶ä¸­çš„éƒ¨åˆ†å‡½æ•°
- ğŸ“Š **æ€»ä½“ä½¿ç”¨ç‡**: çº¦ 60% çš„ä»£ç åœ¨ä½¿ç”¨ä¸­

---

## âŒ å®Œå…¨æœªä½¿ç”¨çš„æ–‡ä»¶ï¼ˆå¯ç«‹å³åˆ é™¤ï¼‰

### 1. `api.py`
- **çŠ¶æ€**: ç©ºæ–‡ä»¶
- **å†…å®¹**: åªæœ‰ç©ºç™½è¡Œ
- **å¼•ç”¨æ£€æŸ¥**: âœ… æ— ä»»ä½•å¼•ç”¨
- **å»ºè®®**: ç«‹å³åˆ é™¤

### 2. `main.py`
- **çŠ¶æ€**: æ— æ•ˆä»£ç 
- **å†…å®¹**: 
  ```python
  if __main__ == "__main__":  # è¯­æ³•é”™è¯¯
      print("Hello from chat-layout-analyzer!")
  ```
- **å¼•ç”¨æ£€æŸ¥**: âœ… æ— ä»»ä½•å¼•ç”¨
- **å»ºè®®**: ç«‹å³åˆ é™¤

### 3. `pipeline2.py`
- **çŠ¶æ€**: å·²è¢«æ›¿ä»£
- **è¯´æ˜**: `dialog_pipeline2.py` çš„å‰èº«ç‰ˆæœ¬
- **å¼•ç”¨æ£€æŸ¥**: âœ… æ— ä»»ä½•å¼•ç”¨
- **å»ºè®®**: ç«‹å³åˆ é™¤

---

## âš ï¸ éƒ¨åˆ†æœªä½¿ç”¨çš„åŠŸèƒ½

### 1. `app_agnostic_text_boxes.py`

#### âœ… å·²ä½¿ç”¨ï¼ˆ6ä¸ªå‡½æ•°ï¼‰
- `assign_speaker_by_edges`
- `filter_by_frequent_edges`
- `filter_center_near_boxes`
- `filter_small_layout_boxes`
- `select_layout_text_boxes`
- `suppress_nested_boxes`

#### âŒ æœªä½¿ç”¨ï¼ˆ9ä¸ªå‡½æ•°ï¼‰
| å‡½æ•°å | åŠŸèƒ½ | å»ºè®® |
|--------|------|------|
| `assign_speaker_by_avatar_order` | åŸºäºå¤´åƒé¡ºåºåˆ†é…è¯´è¯è€… | ä¿ç•™ï¼ˆå¯èƒ½ç”¨äºå…¶ä»–åœºæ™¯ï¼‰ |
| `assign_speaker_by_center_x` | åŸºäºä¸­å¿ƒXåæ ‡åˆ†é…è¯´è¯è€… | ä¿ç•™ï¼ˆå¤‡ç”¨æ–¹æ³•ï¼‰ |
| `assign_speaker_by_nearest_avatar` | åŸºäºæœ€è¿‘å¤´åƒåˆ†é…è¯´è¯è€… | ä¿ç•™ï¼ˆæœªæ¥å¯èƒ½éœ€è¦ï¼‰ |
| `assign_speaker_by_nickname_in_layout` | åŸºäºæ˜µç§°åˆ†é…è¯´è¯è€… | ä¿ç•™ï¼ˆå¯èƒ½ç”¨äºä¼˜åŒ–ï¼‰ |
| `compute_iou` | è®¡ç®—äº¤å¹¶æ¯” | ä¿ç•™ï¼ˆé€šç”¨å·¥å…·ï¼‰ |
| `detect_left_only_layout` | æ£€æµ‹ä»…å·¦ä¾§å¸ƒå±€ | ä¿ç•™ï¼ˆç‰¹å®šåœºæ™¯ï¼‰ |
| `draw_boxes_by_speaker` | æŒ‰è¯´è¯è€…ç»˜åˆ¶è¾¹ç•Œæ¡† | ä¿ç•™ï¼ˆè°ƒè¯•ç”¨ï¼‰ |
| `evaluate_against_gt` | ä¸çœŸå®æ ‡æ³¨å¯¹æ¯” | ä¿ç•™ï¼ˆæµ‹è¯•è¯„ä¼°ç”¨ï¼‰ |
| `save_detection_coords` | ä¿å­˜æ£€æµ‹åæ ‡ | ä¿ç•™ï¼ˆå…¶ä»–æ ¼å¼éœ€æ±‚ï¼‰ |

---

### 2. `nickname_extractor.py`

#### âœ… å·²ä½¿ç”¨
- `extract_nicknames_from_text_boxes`

#### âŒ æœªä½¿ç”¨
| å‡½æ•°å | åŠŸèƒ½ | å»ºè®® |
|--------|------|------|
| `extract_nicknames_smart` | æ™ºèƒ½æ˜µç§°æå– | æ£€æŸ¥æ˜¯å¦ä¸ºæ”¹è¿›ç‰ˆæœ¬ | ä¿ç•™
| `draw_top3_results` | ç»˜åˆ¶å‰3ä¸ªç»“æœ | ä¿ç•™ï¼ˆè°ƒè¯•ç”¨ï¼‰ |

---

### 3. `processors.py`

#### âœ… å·²ä½¿ç”¨
- `ChatMessageProcessor`
- `TextBox`

#### âŒ æœªä½¿ç”¨
| ç±»å | åŠŸèƒ½ | å»ºè®® |
|------|------|------|
| `LayoutVisualizer` | å¸ƒå±€å¯è§†åŒ– | ä¿ç•™ï¼ˆå¯è§†åŒ–éœ€æ±‚ï¼‰ |

---

### 4. `exceptions.py`

#### âœ… å·²ä½¿ç”¨
- `DialogCountTooLowError`
- `NicknameNotFoundError`
- `NicknameScoreTooLowError`
- `UnknownSpeakerTooHighError`

#### âŒ æœªä½¿ç”¨
| å¼‚å¸¸ç±» | åŠŸèƒ½ | å»ºè®® |
|--------|------|------|
| `AnalysisError` | åŸºç¡€åˆ†æé”™è¯¯ | ä¿ç•™ï¼ˆåŸºç±»ï¼‰ |
| `ConfigError` | é…ç½®é”™è¯¯ | ä¿ç•™ï¼ˆåŸºç±»ï¼‰ |
| `NicknameAnalysisError` | æ˜µç§°åˆ†æé”™è¯¯ | ä¿ç•™ï¼ˆåŸºç±»ï¼‰ |
| `DialogAnalysisError` | å¯¹è¯åˆ†æé”™è¯¯ | ä¿ç•™ï¼ˆåŸºç±»ï¼‰ |

---

## ğŸ“Š ä½¿ç”¨æƒ…å†µç»Ÿè®¡

### æ–‡ä»¶çº§åˆ«
```
æ€»æ–‡ä»¶æ•°: 15
â”œâ”€â”€ å®Œå…¨ä½¿ç”¨: 8 (53%) âœ…
â”œâ”€â”€ éƒ¨åˆ†ä½¿ç”¨: 4 (27%) âš ï¸
â””â”€â”€ å®Œå…¨æœªä½¿ç”¨: 3 (20%) âŒ
```

### å‡½æ•°çº§åˆ«ï¼ˆapp_agnostic_text_boxes.pyï¼‰
```
æ€»å‡½æ•°æ•°: 15
â”œâ”€â”€ å·²ä½¿ç”¨: 6 (40%) âœ…
â””â”€â”€ æœªä½¿ç”¨: 9 (60%) âŒ
```

---

## ğŸ”§ æ¸…ç†å»ºè®®

### ç«‹å³æ‰§è¡Œï¼ˆå®‰å…¨æ“ä½œï¼‰
```bash
# åˆ é™¤å®Œå…¨æœªä½¿ç”¨çš„æ–‡ä»¶
rm src/screenshotanalysis/api.py
rm src/screenshotanalysis/main.py
rm src/screenshotanalysis/pipeline2.py
```

### åç»­è€ƒè™‘ï¼ˆéœ€è¯„ä¼°ï¼‰
1. ä¸ºæœªä½¿ç”¨å‡½æ•°æ·»åŠ  `@deprecated` è£…é¥°å™¨
2. åœ¨æ–‡æ¡£ä¸­æ ‡æ³¨å“ªäº›å‡½æ•°å·²åºŸå¼ƒ
3. è§‚å¯Ÿ 3 ä¸ªæœˆåå†³å®šæ˜¯å¦åˆ é™¤

---

## âœ… éªŒè¯ç»“æœ

æ‰€æœ‰æ ‡è®°ä¸º"å®Œå…¨æœªä½¿ç”¨"çš„æ–‡ä»¶å·²é€šè¿‡ä»¥ä¸‹æ£€æŸ¥ï¼š

```bash
# æ£€æŸ¥ç»“æœ
âœ… api.py - æ— ä»»ä½•å¼•ç”¨
âœ… main.py - æ— ä»»ä½•å¼•ç”¨  
âœ… pipeline2.py - æ— ä»»ä½•å¼•ç”¨
```

---

## ğŸ“ ä¾èµ–å…³ç³»

### dialog_pipeline2.py ä½¿ç”¨çš„æ¨¡å—é“¾
```
dialog_pipeline2.py
â”œâ”€â”€ core.py âœ…
â”œâ”€â”€ app_agnostic_text_boxes.py âœ… (éƒ¨åˆ†)
â”œâ”€â”€ nickname_extractor.py âœ… (éƒ¨åˆ†)
â”œâ”€â”€ basemodel.py âœ…
â”œâ”€â”€ processors.py âœ… (éƒ¨åˆ†)
â”‚   â”œâ”€â”€ experience_formula.py âœ…
â”‚   â”œâ”€â”€ chat_layout_detector.py âœ…
â”‚   â””â”€â”€ utils.py âœ…
â”œâ”€â”€ utils.py âœ…
â”œâ”€â”€ config_manager.py âœ…
â””â”€â”€ exceptions.py âœ… (éƒ¨åˆ†)
```

### æœªä½¿ç”¨çš„æ–‡ä»¶
```
âŒ api.py
âŒ main.py
âŒ pipeline2.py
```

---

## ğŸ¯ ç»“è®º

1. **å¯ä»¥å®‰å…¨åˆ é™¤ 3 ä¸ªæ–‡ä»¶**ï¼Œå®ƒä»¬å®Œå…¨æ²¡æœ‰è¢«ä½¿ç”¨
2. **éƒ¨åˆ†æœªä½¿ç”¨çš„å‡½æ•°å»ºè®®ä¿ç•™**ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ï¼š
   - ç”¨äºè°ƒè¯•å’Œæµ‹è¯•
   - ç”¨äºå…¶ä»–åœºæ™¯æˆ–åº”ç”¨
   - ä½œä¸ºå¤‡ç”¨å®ç°æ–¹æ¡ˆ
3. **æ ¸å¿ƒåŠŸèƒ½éƒ½åœ¨æ­£å¸¸ä½¿ç”¨ä¸­**ï¼Œç³»ç»Ÿæ•´ä½“å¥åº·

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰ç–‘é—®æˆ–éœ€è¦è¿›ä¸€æ­¥åˆ†æï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚
